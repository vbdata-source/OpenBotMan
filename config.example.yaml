# ============================================
# OpenBotMan Configuration
# ============================================
# Copy to config.yaml and customize

# ============================================
# Orchestrator Settings
# ============================================
orchestrator:
  # Provider options:
  # - 'claude-cli': Uses Claude Code CLI (works with Claude Pro subscription, no API key)
  #                 Best for: Local development on your machine
  # - 'claude-api': Direct Anthropic SDK (requires ANTHROPIC_API_KEY)
  #                 Best for: Server deployments without browser/CLI access
  # - 'anthropic':  Alias for 'claude-api' (legacy)
  provider: claude-cli
  
  # Model for the main orchestrator
  model: claude-sonnet-4-20250514
  
  # Claude CLI configuration (when provider is 'claude-cli')
  cli:
    # Path to claude CLI command (default: 'claude')
    command: claude
    # Additional CLI arguments
    args: []
    # Maximum turns for agentic loop (default: 10)
    maxTurns: 10
    # Tools to enable (empty = all tools)
    tools: []
  
  # Maximum iterations per task
  maxIterations: 10
  
  # Timeout per agent call (ms)
  agentTimeout: 120000
  
  # Enable autonomous operation
  autonomous: false
  
  # Require human approval for external actions
  humanApproval: true

# ============================================
# Knowledge Base Settings
# ============================================
knowledgeBase:
  enabled: true
  storagePath: /data/knowledge
  
  # Automatically extract learnings from tasks
  autoLearn: true
  
  # Vector database type: memory | chromadb | qdrant
  vectorDb: memory
  
  # Embedding model (for external embedding service)
  embeddingModel: text-embedding-3-small

# ============================================
# Agent Definitions
# ============================================
agents:
  # Claude Code Agent (via CLI)
  - id: claude_code
    name: Claude Code
    role: coder
    provider: anthropic
    model: claude-sonnet-4-20250514
    cli: claude
    cliArgs: ["--json"]
    enabled: true
    systemPrompt: |
      You are an expert software developer.
      Write clean, well-documented code.
      Follow best practices and design patterns.
    capabilities:
      code: true
      review: true
      filesystem: true
      shell: true
      web: false
      mcp: true
      discussion: true
      decisions: true
    maxTokens: 4096
    temperature: 0.7
  
  # Gemini Agent (for review and research)
  - id: gemini
    name: Gemini
    role: reviewer
    provider: google
    model: gemini-2.0-flash
    enabled: false  # Enable when configured
    systemPrompt: |
      You are a critical code reviewer and researcher.
      Look for bugs, security issues, and improvements.
      Provide constructive feedback.
    capabilities:
      code: false
      review: true
      filesystem: false
      shell: false
      web: true
      mcp: false
      discussion: true
      decisions: true
    maxTokens: 4096
    temperature: 0.5
  
  # GPT-4 Agent (for documentation and testing)
  - id: gpt4
    name: GPT-4
    role: tester
    provider: openai
    model: gpt-4-turbo-preview
    enabled: false  # Enable when configured
    systemPrompt: |
      You are an expert at testing and documentation.
      Write comprehensive tests and clear documentation.
    capabilities:
      code: true
      review: false
      filesystem: true
      shell: true
      web: false
      mcp: false
      discussion: true
      decisions: false
    maxTokens: 4096
    temperature: 0.3
  
  # Ollama Local Agent (fast, free)
  - id: ollama
    name: Local LLM
    role: research
    provider: ollama
    model: codellama:13b
    enabled: false  # Enable when Ollama is running
    api:
      baseUrl: http://localhost:11434
    systemPrompt: |
      You are a helpful assistant for quick queries.
      Provide concise, accurate answers.
    capabilities:
      code: true
      review: false
      filesystem: false
      shell: false
      web: false
      mcp: false
      discussion: false
      decisions: false
    maxTokens: 2048
    temperature: 0.5

# ============================================
# Workflows
# ============================================
workflows:
  - id: code_review
    name: Code Review Workflow
    description: Full code review with multiple agents
    steps:
      - id: analyze
        name: Analyze Code
        role: coder
        task: Analyze the code structure and identify areas for review
        output: analysis
      
      - id: review
        name: Security Review
        role: reviewer
        task: Review the code for security issues and best practices
        inputs: [analysis]
        output: review
      
      - id: test
        name: Generate Tests
        role: tester
        task: Generate comprehensive tests based on the analysis
        inputs: [analysis, review]
        output: tests
        maxIterations: 2
  
  - id: feature_development
    name: Feature Development Workflow
    description: Full feature development from spec to tests
    steps:
      - id: plan
        name: Create Plan
        role: architect
        task: Create a detailed implementation plan
        output: plan
      
      - id: implement
        name: Implement Feature
        role: coder
        task: Implement the feature according to the plan
        inputs: [plan]
        output: implementation
        maxIterations: 3
      
      - id: review
        name: Code Review
        role: reviewer
        task: Review the implementation
        inputs: [plan, implementation]
        output: review
      
      - id: test
        name: Write Tests
        role: tester
        task: Write comprehensive tests
        inputs: [implementation]
        output: tests

# ============================================
# Quality Gates
# ============================================
qualityGates:
  - name: Code Coverage
    type: coverage
    threshold: 80
    required: true
  
  - name: Complexity
    type: complexity
    threshold: 15
    required: false
  
  - name: Security Scan
    type: security
    threshold: 0  # No critical vulnerabilities
    required: true

# ============================================
# Security Settings
# ============================================
security:
  enabled: true
  
  # JWT settings
  jwt:
    expiresIn: 3600      # 1 hour
    refreshExpiresIn: 604800  # 7 days
    issuer: openbotman
  
  # Rate limiting
  rateLimit:
    maxRequests: 100
    windowSeconds: 60
  
  # Audit logging
  audit:
    enabled: true
    level: normal  # minimal | normal | verbose
    retentionDays: 90
  
  # Allowed origins (CORS)
  allowedOrigins:
    - "*"  # Restrict in production!
  
  # IP allowlist (empty = all allowed)
  ipAllowlist: []

# ============================================
# Channel Configuration
# ============================================
channels:
  # Microsoft Teams
  teams:
    enabled: false
    appId: ${TEAMS_APP_ID}
    appPassword: ${TEAMS_APP_PASSWORD}
    tenantId: ${TEAMS_TENANT_ID}
    endpoint: /api/messages
    port: 3978
    allowedUsers: []  # Empty = all users
    allowedTenants: []
  
  # Telegram
  telegram:
    enabled: false
    botToken: ${TELEGRAM_BOT_TOKEN}
    webhookUrl: ${TELEGRAM_WEBHOOK_URL}
    allowedUsers: []  # Empty = all users
  
  # Discord
  discord:
    enabled: false
    botToken: ${DISCORD_BOT_TOKEN}
    applicationId: ${DISCORD_APP_ID}
    allowedServers: []
  
  # Slack
  slack:
    enabled: false
    botToken: ${SLACK_BOT_TOKEN}
    appToken: ${SLACK_APP_TOKEN}
    signingSecret: ${SLACK_SIGNING_SECRET}

# ============================================
# API Server Settings
# ============================================
api:
  enabled: true
  port: 8080
  host: "0.0.0.0"
  cors:
    enabled: true
    origins: ["*"]

# ============================================
# Logging
# ============================================
logging:
  level: info  # debug | info | warn | error
  format: json  # json | pretty
  file:
    enabled: true
    path: /data/logs/openbotman.log
    maxSize: 10m
    maxFiles: 5

# ============================================
# Discussion Settings (openbotman discuss)
# ============================================
discussion:
  # Default model for discussion agents
  model: claude-sonnet-4-20250514
  
  # Timeout per agent in seconds
  timeout: 60
  
  # Maximum consensus rounds (default: 10)
  maxRounds: 10
  
  # Output directory for markdown exports
  outputDir: ./discussions
  
  # Max context size in bytes
  maxContext: 50000

  # Rate Limiting Configuration
  # Prevents API rate limit errors when multiple agents make requests
  rateLimiting:
    # Provider-specific delays (milliseconds between requests)
    # Can be overridden per-agent with rateLimitDelayMs
    providers:
      claude-cli: 1500    # Conservative for CLI subprocess
      anthropic: 500      # Direct API is faster
      openai: 200         # OpenAI allows higher rate
      google: 200         # Gemini also fast
      ollama: 100         # Local, minimal delay
      mock: 0             # Testing only
    
    # Default delay for unknown providers
    defaultDelayMs: 1000
    
    # Maximum retry attempts on retryable errors
    maxRetries: 3
    
    # Backoff configuration for retries
    initialBackoffMs: 2000
    maxBackoffMs: 30000

  # Agent configurations with multi-provider support
  # Each agent can use a different provider:
  # - claude-cli: Claude CLI (Pro subscription, no API key needed) - LOCAL DEV
  # - claude-api: Direct Anthropic SDK (requires ANTHROPIC_API_KEY) - SERVER
  # - openai: OpenAI API (requires OPENAI_API_KEY)
  # - google: Google Gemini API (requires GOOGLE_API_KEY)
  # - mock: Mock provider for testing
  agents:
    - id: planner
      role: architect
      name: Planner
      emoji: "üéØ"
      color: magenta
      provider: claude-cli          # Uses Claude CLI
      model: claude-sonnet-4-20250514
      # apiKey: ${GOOGLE_API_KEY}   # Only needed for API providers
      # rateLimitDelayMs: 2000      # Optional: Override provider default (ms)
      systemPrompt: |
        Du bist ein erfahrener Software-Architekt und Planer.
        ROLLE: Du erstellst und √ºberarbeitest Vorschl√§ge basierend auf Feedback.
        Fokus: Patterns, Skalierbarkeit, Trade-offs, langfristige Konsequenzen.
        Stil: Strategisch, ganzheitlich, strukturierte Vorschl√§ge.
        
    - id: coder
      role: coder
      name: Senior Developer
      emoji: "üíª"
      color: cyan
      provider: claude-cli
      model: claude-sonnet-4-20250514
      systemPrompt: |
        Du bist ein erfahrener Software-Entwickler.
        ROLLE: Du bewertest Vorschl√§ge aus Implementierungs-Sicht.
        Fokus: Implementierungs-Details, Code-Qualit√§t, Performance.
        Stil: Pragmatisch, l√∂sungsorientiert, konkrete Code-Beispiele.
        
    - id: reviewer
      role: reviewer
      name: Reviewer
      emoji: "üîç"
      color: yellow
      provider: claude-cli
      model: claude-sonnet-4-20250514
      systemPrompt: |
        Du bist ein kritischer Code-Reviewer und QA-Experte.
        ROLLE: Du identifizierst Risiken und Probleme in Vorschl√§gen.
        Fokus: Risiken, Edge-Cases, Security, Test-Abdeckung.
        Stil: Konstruktiv-kritisch, hinterfrage Annahmen.

  # Example multi-provider configuration:
  # agents:
  #   - id: planner
  #     role: architect
  #     provider: google
  #     model: gemini-2.0-flash
  #     apiKey: ${GOOGLE_API_KEY}
  #     ...
  #   - id: coder
  #     role: coder
  #     provider: claude-cli
  #     model: claude-sonnet-4-20250514
  #     ...
  #   - id: reviewer
  #     role: reviewer
  #     provider: openai
  #     model: gpt-4-turbo
  #     apiKey: ${OPENAI_API_KEY}
  #     ...

  # ============================================
  # SERVER DEPLOYMENT (claude-api instead of CLI)
  # ============================================
  # When deploying on a headless server without Claude CLI:
  # 
  # 1. Set environment variable:
  #    export ANTHROPIC_API_KEY=sk-ant-xxxxx
  #
  # 2. Change provider in agents:
  #    provider: claude-api    # instead of claude-cli
  #
  # Example server config:
  # agents:
  #   - id: planner
  #     role: architect
  #     provider: claude-api      # Direct API - no CLI needed
  #     model: claude-sonnet-4-20250514
  #     apiKey: ${ANTHROPIC_API_KEY}
  #     ...
  #
  # Note: API calls are billed per token, while CLI uses your Pro subscription
